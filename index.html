<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HolaTube — All-in-One Demo</title>
  <style>
    :root{--max:1100px}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, Arial, sans-serif; margin:0; color:#111; background:#fafafa}
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:#fff;border-bottom:1px solid #e6e6e6;position:sticky;top:0;z-index:10}
    .brand{font-weight:700}
    .searchWrap input{padding:8px 10px;width:300px;border:1px solid #ddd;border-radius:6px}
    .container{display:grid;grid-template-columns:200px 1fr 260px;gap:16px;max-width:var(--max);margin:18px auto;padding:0 10px}
    .leftcol nav a{display:block;padding:8px 6px;color:#333;text-decoration:none}
    .card{background:#fff;padding:12px;border:1px solid #eee;border-radius:8px;margin-bottom:12px;box-shadow:0 1px 2px rgba(0,0,0,0.02)}
    .content .card{margin-bottom:16px}
    #videos .videoCard, #shortsList .shortCard{border:1px solid #f0f0f0;padding:8px;margin:8px 0;border-radius:6px;background:#fff}
    video{max-width:100%;height:auto;border-radius:6px;background:#000}
    .shortsList{display:flex;gap:8px;flex-wrap:wrap}
    .shortCard video{width:200px;height:350px;object-fit:cover;border-radius:6px}
    .auth button{padding:8px 10px;border-radius:6px;border:1px solid #ccc;background:#fafafa;cursor:pointer}
    .status{margin-top:8px;color:#444}
    .footer{text-align:center;padding:18px 0;color:#666;border-top:1px solid #f0f0f0;margin-top:20px;background:#fff}
    .meta{margin-top:8px;display:flex;gap:8px}
    .meta button{padding:6px 8px;border:1px solid #ddd;border-radius:6px;background:#fff;cursor:pointer}
    input, textarea{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-top:8px}
    @media(max-width:900px){.container{grid-template-columns:1fr;}.rightcol{display:none}.searchWrap input{width:120px}}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">HolaTube (Demo)</div>
    <div class="searchWrap">
      <input id="searchInput" placeholder="Search videos..." />
    </div>
    <div id="auth" class="auth">
      <button id="btn-login">Sign in with Google</button>
      <button id="btn-logout" style="display:none">Logout</button>
    </div>
  </header>

  <main class="container">
    <aside class="leftcol">
      <nav>
        <a href="#" id="nav-feed">Home</a>
        <a href="#" id="nav-shorts">Shorts</a>
      </nav>
    </aside>

    <section class="content">
      <section id="uploader" class="card">
        <h2>Upload Video (Demo)</h2>
        <input type="file" id="videoFile" accept="video/*">
        <input id="title" placeholder="Title" />
        <textarea id="description" placeholder="Description"></textarea>
        <label><input type="checkbox" id="isShortCheck"> Mark as Short (&lt;60s)</label>
        <button id="btn-upload">Upload</button>
        <div id="uploadStatus" class="status"></div>
      </section>

      <section id="feed" class="card">
        <h2>Feed</h2>
        <div id="videos"></div>
      </section>

      <section id="shorts" class="card">
        <h2>Shorts</h2>
        <div id="shortsList" class="shortsList"></div>
      </section>
    </section>

    <aside class="rightcol">
      <div class="card">
        <h3>Your Profile</h3>
        <div id="profileInfo">Not signed in</div>
      </div>
    </aside>
  </main>

  <footer class="footer">© HolaTube Demo — For testing only</footer>

  <!-- Firebase libs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <script>
    // ✅ Replace this config with your Firebase project config
    const firebaseConfig = {
      apiKey: "REPLACE_ME",
      authDomain: "REPLACE_ME",
      projectId: "REPLACE_ME",
      storageBucket: "REPLACE_ME",
      messagingSenderId: "REPLACE_ME",
      appId: "REPLACE_ME"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    const btnLogin = document.getElementById('btn-login');
    const btnLogout = document.getElementById('btn-logout');
    const btnUpload = document.getElementById('btn-upload');
    const videoFile = document.getElementById('videoFile');
    const uploadStatus = document.getElementById('uploadStatus');
    const videosDiv = document.getElementById('videos');
    const shortsDiv = document.getElementById('shortsList');
    const profileInfo = document.getElementById('profileInfo');
    const searchInput = document.getElementById('searchInput');

    btnLogin.onclick = async ()=> {
      const provider = new firebase.auth.GoogleAuthProvider();
      try { await auth.signInWithPopup(provider); } catch(e){ alert('Auth failed: '+e.message); }
    };
    btnLogout.onclick = ()=> auth.signOut();

    auth.onAuthStateChanged(user => {
      if(user){
        btnLogin.style.display='none'; btnLogout.style.display='inline-block';
        profileInfo.innerHTML = `<div><strong>${escapeHtml(user.displayName||'User')}</strong><br>${escapeHtml(user.email||'')}</div>`;
      } else {
        btnLogin.style.display='inline-block'; btnLogout.style.display='none';
        profileInfo.innerText = 'Not signed in';
      }
    });

    btnUpload.onclick = async () => {
      const file = videoFile.files[0];
      const title = document.getElementById('title').value.trim() || 'Untitled';
      const description = document.getElementById('description').value.trim() || '';
      const isShort = document.getElementById('isShortCheck').checked;
      const user = auth.currentUser;
      if(!user){ alert('Please sign in first'); return; }
      if(!file){ alert('Choose a video file'); return; }
      if(file.size > 200*1024*1024){ alert('File too large for demo'); return; }

      const id = Date.now().toString();
      const ref = storage.ref().child('videos/' + user.uid + '/' + id + '_' + file.name);
      const uploadTask = ref.put(file);
      uploadStatus.innerText = 'Uploading...';

      uploadTask.on('state_changed', snap => {
        const pct = Math.round((snap.bytesTransferred / snap.totalBytes)*100);
        uploadStatus.innerText = 'Uploading... ' + pct + '%';
      }, err => uploadStatus.innerText = 'Error: '+err.message, async () => {
        const url = await ref.getDownloadURL();
        await db.collection('videos').doc(id).set({
          id, title, description, url, owner:user.uid,
          ownerName:user.displayName||null,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          likes:0, views:0, isShort:!!isShort
        });
        uploadStatus.innerText = 'Upload complete';
        videoFile.value=''; document.getElementById('title').value=''; document.getElementById('description').value='';
        loadFeed();
      });
    };

    async function loadFeed(query){
      videosDiv.innerHTML = 'Loading...'; shortsDiv.innerHTML='';
      let q = db.collection('videos').orderBy('createdAt','desc').limit(50);
      if(query){ q = db.collection('videos').orderBy('title').startAt(query).endAt(query + '\uf8ff'); }
      const snap = await q.get();
      videosDiv.innerHTML = '';
      snap.forEach(doc=>{
        const d=doc.data();
        const c=document.createElement('div'); c.className='videoCard';
        c.innerHTML=`<h3>${escapeHtml(d.title)}</h3>`;
        const v=document.createElement('video'); v.src=d.url; v.controls=true;
        c.appendChild(v);
        const meta=document.createElement('div'); meta.className='meta';
        const like=document.createElement('button'); like.innerText='Like ('+(d.likes||0)+')';
        like.onclick=()=>likeVideo(doc.id);
        const view=document.createElement('button'); view.innerText='View'; view.onclick=()=>{incrementViews(doc.id); window.open(d.url);};
        meta.appendChild(like); meta.appendChild(view);
        c.appendChild(meta);
        videosDiv.appendChild(c);
        if(d.isShort){
          const s=document.createElement('div'); s.className='shortCard';
          const sv=document.createElement('video'); sv.src=d.url; sv.controls=true; sv.muted=true;
          s.appendChild(sv); shortsDiv.appendChild(s);
        }
      });
      if(!snap.size) videosDiv.innerHTML='<i>No videos yet</i>';
    }

    function escapeHtml(text){return (text||'').replace(/[&<>"'`]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;',"`":'&#96;'}[c]));}
    async function likeVideo(id){const ref=db.collection('videos').doc(id);await db.runTransaction(async tx=>{const d=await tx.get(ref);if(!d.exists)return;tx.update(ref,{likes:(d.data().likes||0)+1});});loadFeed();}
    async function incrementViews(id){await db.collection('videos').doc(id).update({views:firebase.firestore.FieldValue.increment(1)});}
    searchInput.addEventListener('keyup',e=>{const q=e.target.value.trim();if(q.length>=2)loadFeed(q);else if(!q)loadFeed();});
    loadFeed();
  </script>
</body>
</html>
